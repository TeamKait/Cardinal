import{d as x,c as L,w as k,u as r,_ as K,r as I,o as u,a as v,n as O,b as V,t as p,e as Q,f as W,v as X,g as Y,i as Z,h as z,j as S,k as b,l as R,m as ee,p as c,F as T,T as $,q as se,s as F,x as B,y as te,z as ae,A as H,B as j,C as D,D as q,E as ie,G as ne,H as le,I as M,J as N,K as h,L as oe,M as m,N as ce,O as re,P as w,Q as de,R as ue,S as fe,U as me}from"./index-DZzsaz5I.js";import{_ as ke,a as ye,b as _e}from"./Input.vue_vue_type_script_setup_true_lang-Bi-gLgzn.js";import{_ as pe}from"./Spinner.vue_vue_type_script_setup_true_lang-hg3YUgZs.js";const P=x({__name:"CircleButton",setup(i){return(t,s)=>(u(),L(r(K),{size:"icon",variant:"outline",class:"flex-center rounded-full"},{default:k(()=>[I(t.$slots,"default")]),_:3}))}});class G{id;user;label;content;likesBy;dislikesBy;createdAt;constructor(t,s,a,n,o,e,l){this.user=t,this.label=s,this.content=a,this.id=n,this.likesBy=o??[],this.dislikesBy=e??[],this.createdAt=l}get likesCount(){return this.likesBy?.length??0}get dislikesCount(){return this.dislikesBy?.length??0}}const ve={key:0},he={key:1},E=x({__name:"WithLabel",props:{label:{},position:{}},setup(i){const t=i;function s(a){return t.position==a}return(a,n)=>(u(),v("div",{class:O(["flex gap-1",{"flex-col":s("top")||s("bottom")}])},[s("left")||s("top")?(u(),v("label",ve,p(t.label),1)):V("",!0),I(a.$slots,"default"),s("right")||s("bottom")?(u(),v("label",he,p(t.label),1)):V("",!0)],2))}}),ge=x({__name:"Textarea",props:{class:{},defaultValue:{},modelValue:{}},emits:["update:modelValue"],setup(i,{emit:t}){const s=i,n=Q(s,"modelValue",t,{passive:!0,defaultValue:s.defaultValue});return(o,e)=>W((u(),v("textarea",{"onUpdate:modelValue":e[0]||(e[0]=l=>Z(n)?n.value=l:null),"data-slot":"textarea",class:O(r(Y)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s.class))},null,2)),[[X,r(n)]])}}),Be=x({__name:"NewPostDialog",props:{modelValue:{},modelModifiers:{},condition:{type:Boolean},conditionModifiers:{}},emits:["update:modelValue","update:condition"],setup(i){const t=z(),s=S(i,"modelValue"),a=S(i,"condition"),n=b(""),o=b("");function e(){s.value=new G(t.currentUser?.email,n.value,o.value),a.value=n.value.length>0&&o.value.length>0}return R(e),ee(()=>[n,o],e,{deep:!0}),(l,d)=>(u(),v(T,null,[c(E,{label:"Заголовок поста",position:"top"},{default:k(()=>[c(r(ke),{modelValue:n.value,"onUpdate:modelValue":d[0]||(d[0]=f=>n.value=f),placeholder:"Заголовок"},null,8,["modelValue"])]),_:1}),c(E,{label:"Содержание",position:"top"},{default:k(()=>[c(r(ge),{modelValue:o.value,"onUpdate:modelValue":d[1]||(d[1]=f=>o.value=f),placeholder:"Напишите что-нибудь",class:"resize-none w-100"},null,8,["modelValue"])]),_:1})],64))}}),C="posts";async function xe(i){return await $(async()=>(await te(F(B,C),{user:i.user,label:i.label,content:i.content,likesBy:[],dislikesBy:[],createdAt:ae()}),!0))}async function be(){return await $(async()=>(await se(F(B,C))).docs.map(s=>{const a=s.data(),n=a?.createdAt?.toDate?a.createdAt.toDate():void 0;return new G(a?.user??"N/A",a?.label??"",a?.content??"",s.id,a?.likesBy??[],a?.dislikesBy??[],n)}))}async function we(i,t){return await $(async()=>{const s=H(B,C,i);return await j(B,async a=>{(((await a.get(s)).data()||{}).likesBy??[]).includes(t)?a.update(s,{likesBy:D(t)}):a.update(s,{likesBy:q(t),dislikesBy:D(t)})}),!0})}async function Le(i,t){return await $(async()=>{const s=H(B,C,i);return await j(B,async a=>{(((await a.get(s)).data()||{}).dislikesBy??[]).includes(t)?a.update(s,{dislikesBy:D(t)}):a.update(s,{dislikesBy:q(t),likesBy:D(t)})}),!0})}const J=ie("posts",()=>{const i=ne(),t=b([]);async function s(){const e=await be();e&&(t.value=e)}async function a(){const e=await i.DialogResults("Новый пост",new le(Be));if(!e||!e.length)return;const l=e[0];await xe(l)&&await s()}async function n(e){if(!e?.id)return;const l=M.currentUser?.uid;if(!l){N.error("Войдите, чтобы поставить реакцию");return}const d=[...e.likesBy??[]],f=[...e.dislikesBy??[]];if(e.likesBy?.includes(l))e.likesBy=(e.likesBy??[]).filter(_=>_!==l);else{const _=(e.likesBy??[]).includes(l)?e.likesBy??[]:[...e.likesBy??[],l],U=(e.dislikesBy??[]).filter(A=>A!==l);e.likesBy=_,e.dislikesBy=U}await we(e.id,l)||(e.likesBy=d,e.dislikesBy=f)}async function o(e){if(!e?.id)return;const l=M.currentUser?.uid;if(!l){N.error("Войдите, чтобы поставить реакцию");return}const d=[...e.likesBy??[]],f=[...e.dislikesBy??[]];if(e.dislikesBy?.includes(l))e.dislikesBy=(e.dislikesBy??[]).filter(_=>_!==l);else{const _=(e.dislikesBy??[]).includes(l)?e.dislikesBy??[]:[...e.dislikesBy??[],l],U=(e.likesBy??[]).filter(A=>A!==l);e.dislikesBy=_,e.likesBy=U}await Le(e.id,l)||(e.likesBy=d,e.dislikesBy=f)}return{posts:t,LoadPosts:s,NewPost:a,ToggleLike:n,ToggleDislike:o}}),Ve={class:"flex items-center gap-3"},De={class:"flex flex-col"},$e={class:"text-2xl"},Ce={key:0,class:"text-xs text-muted-foreground"},Ue={class:"text-5xl"},Ae={class:"text-2xl"},Te={class:"flex gap-2 mt-2 items-center"},Ne={class:"flex items-center gap-1"},Pe={class:"text-sm"},ze={class:"flex items-center gap-1"},Se={class:"text-sm"},Me=x({__name:"PostComponent",props:{post:{}},setup(i){const t=i,s=J(),a=z(),n=h(()=>a.currentUser?.uid),o=h(()=>!!t.post&&!!n.value&&t.post.likesBy?.includes(n.value)),e=h(()=>!!t.post&&!!n.value&&t.post.dislikesBy?.includes(n.value)),l=h(()=>o.value?"mdi:thumbs-up":"mdi:thumbs-up-outline"),d=h(()=>e.value?"mdi:thumbs-down":"mdi:thumbs-down-outline"),f=h(()=>{const y=t.post?.createdAt;return y?new Intl.DateTimeFormat(void 0,{dateStyle:"medium",timeStyle:"short"}).format(y):""});return(y,g)=>(u(),L(r(oe),null,{default:k(()=>[c(r(ye),null,{default:k(()=>[m("div",Ve,[c(r(ce),{class:"size-15"},{default:k(()=>[c(r(re),null,{default:k(()=>[c(w,{icon:"radix-icons:person",class:"size-7"})]),_:1})]),_:1}),m("div",De,[m("h1",$e,p(i.post?.user??"NULL_USER"),1),f.value?(u(),v("span",Ce,p(f.value),1)):V("",!0)])])]),_:1}),c(r(_e),{class:"w-150"},{default:k(()=>[m("h1",Ue,p(i.post?.label??"NULL_LABEL"),1),m("p",Ae,p(i.post?.content??"NULL_CONTENT"),1),m("div",Te,[c(P,{onClick:g[0]||(g[0]=_=>r(s).ToggleLike(i.post)),variant:"outline"},{default:k(()=>[m("div",Ne,[c(w,{icon:l.value},null,8,["icon"]),m("span",Pe,p(i.post?.likesCount??0),1)])]),_:1}),c(P,{onClick:g[1]||(g[1]=_=>r(s).ToggleDislike(i.post)),variant:"outline"},{default:k(()=>[m("div",ze,[c(w,{icon:d.value},null,8,["icon"]),m("span",Se,p(i.post?.dislikesCount??0),1)])]),_:1})])]),_:1})]),_:1}))}}),Ee={class:"flex flex-col gap-5"},Fe=x({__name:"HomeView",setup(i){const t=z(),s=b(t.currentUser),a=h(()=>!!s.value),n=J(),o=b(!0);let e;R(async()=>{e=de(t,d=>{s.value=d}),await ue(async()=>{await n.LoadPosts()},o)}),fe(()=>{e&&e()});function l(){a.value?n.NewPost():N.warning("Войдите или создайте аккаунт, чтобы создать пост")}return(d,f)=>(u(),v(T,null,[c(P,{onClick:l,variant:a.value?"default":"outline",class:"size-20 fixed right-5 bottom-5"},{default:k(()=>[c(w,{icon:"radix-icons:plus",class:"size-10"})]),_:1},8,["variant"]),o.value&&r(n).posts.length==0?(u(),L(r(pe),{key:0,class:"size-10"})):V("",!0),m("div",Ee,[(u(!0),v(T,null,me(r(n).posts,y=>(u(),L(Me,{key:y.id??y.label,post:y},null,8,["post"]))),128))])],64))}});export{Fe as default};
